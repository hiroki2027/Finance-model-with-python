# 戦略組の作業ステップ：月単位の株式方向性予測と取引シグナル生成

## はじめに

このドキュメントは、半自動売買システムにおける「戦略組」が月単位の株価方向性予測を行い、最終的に手動売買のための取引シグナルを生成するまでの具体的な作業ステップをまとめたものである。ここでの戦略組のゴールは、信頼性の高い売買シグナル（例：買い推奨、売り推奨、様子見）を人間に提示することである。

## フェーズ1: 準備と計画

### 1. 目標の明確化とスコープ定義

* **予測対象:** どの市場の、どの銘柄群か（例: 日経225構成銘柄、TOPIX Core30、特定のセクターの代表銘柄群など）。
### 戦略の選択肢
１、単元未満株を使ったスイングトレード
最大３−５銘柄に分散する
* **予測期間:** 「翌月」の何を予測するか（例: 翌月末の終値が当月末の終値より「上昇」「下落」「横ばい」のどれになるか。あるいは、上昇/下落確率）である。
* **シグナルの種類:** どのようなシグナルを生成するか（例: 買い/売り/様子見、またはスコア表示）である。
シンプルに買時からの比率で考える。
* **達成基準:** どのような状態になればモデルが「使える」と判断するか（例: バックテストでの期待リターン、勝率、シャープレシオの目標値など）である。

### 2. データ収集計画

* **必要なデータのリストアップ:**
    * 株価データ (月足): 始値、高値、安値、終値、出来高。
    * テクニカル指標: 月足ベースで計算可能なもの（移動平均、MACD、RSIなど）。
    * ファンダメンタルズデータ: 企業の財務諸表データ（四半期/通期）、PER、PBRなど。どのタイミングのデータを月次予測に使うか考慮。
    * マクロ経済指標: 国内外の金利、インフレ率、GDP成長率、為替レートなど、月次で入手可能なもの。
    * その他: 市場センチメント指標、アノマリーデータ（例: 月効果）など、利用を検討するデータ。
* **データソースの特定:** どこからデータを取得するか（例: 証券会社提供データ、Yahoo Finance, J-Quants API, EDINET, 各種統計機関）。
* **データ収集期間の設定:** 最低でも10～15年以上、できればそれ以上の長期データを収集する計画を立てる（月足データはサンプル数が限られるため）。

### 3. 開発環境の整備

* プログラミング言語（Pythonが一般的）、主要ライブラリ（Pandas, NumPy, Scikit-learn, Matplotlib, Seaborn, LightGBM/XGBoostなど）、開発ツール（Jupyter Notebook, VSCodeなど）を準備する。

## フェーズ2: データ収集と分析・前処理

### 4. データ収集の実行

* 計画に基づき、各種データを実際に収集する。APIを利用する場合はAPIキーの取得などが必要となる。手動で収集する場合はその手間を考慮する。
* 収集したデータを整理し、ローカル環境やデータベースに保存する。

### 5. 探索的データ分析 (EDA)

* 収集したデータの基本的な統計量（平均、中央値、標準偏差など）を確認する。
* データの分布を可視化し、外れ値や欠損値の状況を把握する。
* 各データ間の相関関係などを調べ、予測に役立ちそうな特徴の当たりをつける。
* 時系列データのトレンドや季節性を確認する。

### 6. データ前処理

* **欠損値の処理:** 欠損しているデータに対して、削除、平均値/中央値での補完、時系列性を考慮した補間（例: 前月の値で埋める、線形補間）などを行う。
* **外れ値の処理:** 極端な外れ値がある場合、その原因を調査し、必要に応じて丸め処理（クリッピング）や削除、変換を検討する。
* **データ型の統一:** 日付データや数値データなど、適切なデータ型に変換する。
* **データの同期:** 発表タイミングが異なるデータ（例: 企業の財務データは株価より遅れて発表される）について、予測時点で利用可能な情報のみを使うように調整する（未来のデータリークを防ぐ）。

## フェーズ3: 特徴量エンジニアリングとモデル構築

### 7. 特徴量エンジニアリング

* 収集・前処理したデータから、予測モデルの精度向上に寄与する可能性のある「特徴量」を作成する。
    * **テクニカル指標の計算:** 移動平均線（短期・中期・長期）、MACD、RSI、ボリンジャーバンド、ストキャスティクスなどを月足データから計算する。
    * **価格・出来高の変化率:** 過去1ヶ月、3ヶ月、6ヶ月、12ヶ月などの株価や出来高の変化率。
    * **ファンダメンタルズ指標の加工:** PER、PBR、ROE、自己資本比率、売上高成長率、利益成長率などを計算し、月次の特徴量として利用できるようにする（例: 最新の決算発表値を次の決算発表まで利用）。
    * **マクロ経済指標の利用:** 収集したマクロ経済指標をそのまま、または変化率などにして特徴量に加える。
    * **ダミー変数:** 特定の月（1月など）や、特定のイベント（リーマンショック期など）を示すフラグ。
* 作成した特徴量の中から、実際にモデルに使用するものを選択する（多すぎると過学習の原因になるため、特徴量選択の手法も検討する）。

### 8. ターゲット変数の定義

* 何を予測するかの「正解ラベル」を作成する。
* 例: 「翌月の月末終値が当月の月末終値よりX%以上上昇したら1、Y%以上下落したら-1、それ以外は0」など。
* あるいは、「翌月の月末終値が当月の月末終値より上昇したか否か (1/0)」など、よりシンプルな2値分類も考えられる。

### 9. 学習データ・検証データ・テストデータの分割

* 時系列性を考慮し、データを時間順に分割する。
    * **学習データ:** モデルの学習に使用する。
    * **検証データ:** 学習中のモデルの性能評価やハイパーパラメータ調整に使用する。
    * **テストデータ:** 学習が完了したモデルの最終的な性能評価に使用する（未知のデータに対する汎化性能を見る）。
* 例: 2000年～2015年を学習データ、2016年～2017年を検証データ、2018年～2023年をテストデータとする。

### 10. 機械学習モデルの選択と学習

* 予測タスク（分類問題または回帰問題）に適したモデルを選択する。
    * **分類モデル例:** ロジスティック回帰、サポートベクターマシン(SVM)、決定木、ランダムフォレスト、勾配ブースティング（LightGBM, XGBoostなど）。
* 選択したモデルを学習データで学習させる。
* 検証データを用いて、ハイパーパラメータのチューニングを行う（例: グリッドサーチ、ランダムサーチ、ベイズ最適化など）。

## フェーズ4: モデル評価と取引ロジック設計

### 11. モデルの評価

* テストデータを用いて、学習済みモデルの性能を評価する。
    * **分類精度指標:** 正解率 (Accuracy)、適合率 (Precision)、再現率 (Recall)、F1スコア、混同行列、ROC曲線、AUCなど。
    * **金融ドメインでの評価（バックテスト）:**
        * テスト期間において、モデルの予測に基づいて売買シミュレーションを行う。
        * 累積リターン、年率リターン、シャープレシオ、ソルティノレシオ、最大ドローダウン、勝率、プロフィットファクターなどを計算する。
        * 可能であれば、取引コスト（手数料、スリッページ）も考慮に入れる。
* 評価結果が芳しくない場合は、特徴量の見直し、モデルの変更、ハイパーパラメータの再調整など、フェーズ3に戻って改善を試みる。

### 12. 取引判断ロジックの設計

* モデルの予測結果（例: 各クラスの予測確率、分類されたクラス）を、具体的な「売買シグナル」に変換するためのルールを定義する。
* **ルール例:**
    * 「"上昇"クラスと予測され、かつ上昇確率が70%以上なら『買い推奨』」
    * 「"下落"クラスと予測され、かつ下落確率が70%以上なら『売り推奨』」
    * 「それ以外、または"横ばい"クラスと予測された場合は『様子見』」
* オプションとして、市場全体のトレンドフィルター（例: 日経平均が25日移動平均線より上なら買いシグナルのみ有効）や、ボラティリティフィルターなどを追加することも考えられる。

## フェーズ5: システム化と運用準備

### 13. シグナル生成システムのプロトタイプ作成

* 学習済みの最良モデルと取引判断ロジックを組み合わせ、入力データ（最新の市場データ）から翌月の売買シグナルを自動で生成するスクリプト（Pythonなど）を作成する。
* シグナルの出力形式を決定する（例: CSVファイルに出力、メールで通知、簡単なダッシュボードに表示など、手動売買を行う人が見やすい形式）。

### 14. ドキュメンテーションと運用計画

* 開発したモデルの概要、使用したデータ、特徴量、評価結果、取引判断ロジックの詳細などをドキュメントにまとめる。
* モデルの再学習の頻度やタイミング（例: 半年に一度、市場環境が大きく変わったと感じた時など）を計画する。
* 生成されたシグナルをどのように解釈し、手動売買に活かすかの簡単なガイドラインを作成する。

## おわりに

これらのステップは一例であり、プロジェクトの特性や進捗に応じて調整が必要である。重要なのは、一度システムを構築して終わりではなく、定期的にモデルのパフォーマンスを監視し、市場の変化に合わせて継続的に改善していくことである。