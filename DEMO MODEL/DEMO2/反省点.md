### ロジスティック回帰モデル改善メモ（コード抜き・読みやすく整理）

1. #### 目的と背景
	•	現状の課題
	•	3か月モメンタムと月末RSIを特徴量にしたロジスティック回帰を用いて翌月の株価上昇／下落を予測しているが、
	•	「RSIが極端に高い（過熱）場合」や「RSIが極端に低い（売られすぎ）場合」に即座に反転シグナルを返しにくい
	•	モデルのみでは過熱・売られすぎの局面での判断がぶれやすい
	•	改善方針
	1.	RSIによるルールベース判定
	•	RSI > 70 のときは無条件に“下落”と決める
	•	RSI < 30 のときは無条件に“上昇”と決める
	•	中間領域（30 ≤ RSI ≤ 70）のときだけロジスティック回帰モデルに判断を委ねる
	2.	学習済みモデルの係数（重み）を手動で調整
	•	モデルが学習で自動取得する係数 (coef_) と切片 (intercept_) を、必要に応じて手動で上書きし、
	•	モメンタムをより重視したい、あるいは
	•	RSIの影響をより強めたい／弱めたい
といった調整を行う

――以上の２本立てで、「経験則に基づく過熱・売られすぎサインを確実に反映しつつ、モデル部分では柔軟に学習データの傾向を取り込む」ハイブリッド戦略を目指す。

⸻

2. #### RSIルールベース判定のポイント
	1.	RSIとは
	•	過去14日間の「上昇幅／下落幅のバランス」を 0～100 の値で示すオシレーター指標。
	•	RSI > 70：過熱・買われすぎ → そろそろ下落が来る可能性が高い
	•	RSI < 30：売られすぎ・反発サイン → そろそろ上昇しやすい
	2.	ルール適用の流れ
	1.	まず RSI をチェックする
	2.	RSI > 70 → 即座に「下落(0)」を返す
	3.	RSI < 30 → 即座に「上昇(1)」を返す
	4.	それ以外（30 ≤ RSI ≤ 70） → ロジスティック回帰モデルに判断を任せる
	3.	導入する理由
	•	シンプルだが有効な経験則を前置きとして組み込むことで、モデル単体では捉えにくい急激な反転局面に素早く対応できる。
	•	RSIの閾値（30／70）はあくまで一般的な目安のため、実際の銘柄特性に応じて「RSI<25／RSI>75」など閾値を微調整しておくとさらに効果的。
	4.	留意点
	•	RSIルールを過度にきつくすると、下降トレンドが継続しているのに“売られすぎ”と判定してしまうケースが増える。
	•	ルールで完全に上書きする領域はあくまで「極端に売られすぎ・買われすぎと判断できる範囲だけ」に絞るのが無難。

⸻

3. #### ロジスティック回帰の係数（重み）調整
	1.	ロジスティック回帰の仕組み（おさらい）
	•	モデルは2つの説明変数（momentum_3m, RSI_month_end）をそれぞれ重み付けし、切片（バイアス）を足して「線形スコア」を算出する。
	•	そのスコアをシグモイド関数に通して「株価上昇確率」を得て、0.5を境に上昇(1) / 下落(0) を判定する。
	2.	自動学習で得られる係数
	•	学習を行うと、model.coef_ に [w1, w2]、model.intercept_ に [b] がセットされる。
	•	例：
	•	w1 > 0 なら「モメンタムが大きいほど上昇方向に寄与する」
	•	w2 < 0 なら「RSIが高いほど下落方向に寄与する」
	3.	ハイパーパラメータ調整による再学習
	•	C（正則化強度）を変えると全体の重みの大きさに影響が出る。
	•	penalty を変えると重みのスパース性（L1 vs L2）に影響する。
	•	クラス不均衡が強い場合は class_weight="balanced" を指定して「上昇／下落どちらかに偏りがあっても重み付けして学習」できる。
	4.	係数を手動で上書きするケース
	•	「学習済みの値をひとまずベースにするが、一部だけ自分で調整したい」
	•	例：
	•	モメンタム寄与を強めたい → w1 を学習後に 0.7 から 1.0 に増やす
	•	RSI の逆張り効果を強めたい → w2 を学習後に −0.02 から −0.05 に変更
	•	全体的に上がりやすいバイアスを入れたい → b を 0.2 から 0.1 に調整
これにより、モデルの学習データに基づく傾向を補正しつつ、自分の経験則や直感を反映したきめ細かなチューニングが行える。
	5.	実践する流れ（手順）
	1.	モデルを通常どおり学習し、coef_ と intercept_ を確認する
	2.	必要に応じて coef_ と intercept_ を手動で書き換える
	3.	以降の予測は、その新しい重みとバイアスで行う
	6.	留意点
	•	手動上書きすると学習データに基づく自動調整効果を一部失う。
	•	「経験的にこの銘柄はモメンタムを重視すべき」「あるいはRSIを強めに反映すべき」という明確な根拠がない場合は、グリッドサーチなどで自動調整したほうがバイアスが少なくなる。
	•	すべて手動で設定すると、将来データでの再現性・汎用性を担保しにくいため、あくまで「ピンポイントな修正」として使うのが望ましい。

⸻

4. #### 具体的改善フロー（要点のみ）
	1.	学習フェーズ
	•	LogisticRegression を通常どおり動かしてモデルを学習する
	•	学習結果として得られた重み coef_ = [w1_learned, w2_learned]、切片 intercept_ = [b_learned] を控えておく
	2.	重みの手動調整（任意）
	•	例：
	•	coef_[0][0] = 1.0  ← モメンタム寄与を強化
	•	coef_[0][1] = -0.05 ← RSI の逆張り効果を強化
	•	intercept_ = [0.1]  ← 全体的にやや上昇しやすいバイアスを追加
	3.	予測フェーズ
	•	テストデータを入力する前に、最初に RSI をチェック
	•	RSI > 70 → 無条件に “下落(0)” を予測
	•	RSI < 30 → 無条件に “上昇(1)” を予測
	•	30 ≤ RSI ≤ 70 → ロジスティック回帰モデル（新しい coef_ と intercept_）に入力して “0/1” を予測
	4.	評価・確認
	•	予測結果を正解ラベルと照合し、Accuracy や Precision／Recall、F1 などで性能を確認
	•	必要に応じて閾値（RSI=30／70）や重みの値を再調整

⸻

5. #### 今後の検討・拡張ポイント
	•	閾値チューニング
	•	RSI の閾値を 30・70 以外（たとえば 25・75）にするかどうか、過去データをもとに最適値を探索する
	•	特徴量の拡充
	•	モメンタムとRSI以外に、MACD、移動平均乖離、出来高モメンタム、ボラティリティなどを加えて予測精度向上を図る
	•	モデルの評価方法の強化
	•	「末尾10ヵ月だけをテスト」の固定分割では偏りが出やすいので、TimeSeriesSplit などで複数回の時系列クロスバリデーションを試す
	•	実際の売買シミュレーション（バックテスト）を併用し、「モデル＋ルール」がどの程度リターンを改善するかを検証
	•	運用自動化
	•	データ取得から前処理・学習・予測・バックテストまでをパイプライン化し、定期的にバッチ実行できる仕組みを構築する

⸻
