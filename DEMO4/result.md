### DEMO4

- DEMO3 で作ったパイプラインをモジュール化した( demo4_phase2 )


# DEMO4 – 5‑fold CV 結果まとめ

## 1. 検証結果概要  
（XGBoost・3クラス分類／5‑day ±1 % リターン）

| Ticker | Avg. Accuracy | Best Fold | Worst Fold |
|:------:|:-------------:|:---------:|:----------:|
| **9984.T** | **0.385** | 0.415 | 0.359 |
| **7733.T** | 0.379 | 0.413 | 0.345 |
| **6981.T** | 0.376 | 0.392 | 0.357 |
| **6861.T** | 0.367 | 0.413 | 0.335 |
| **8306.T** | 0.366 | 0.390 | 0.333 |
| **6758.T** | 0.359 | 0.396 | 0.331 |
| **4063.T** | 0.358 | **0.419** | 0.329 |
| **7203.T** | 0.356 | 0.376 | 0.316 |
| **8058.T** | 0.350 | 0.384 | 0.310 |

> **全銘柄平均 Accuracy ≈ 0.37**  
> *ランダム分類 (1/3 ≈ 0.33) と大差なし*

---

## 2. この結果から言えること

1. **予測精度は依然ランダム水準**  
   - 最高でも 0.419、平均 0.37。多くの銘柄でランダムの 33 % と僅差。  
2. **クラス1（横ばい）の Recall が低い**  
   - ±1 % 未満領域はノイズが大きく、モデルが特徴を捉えられていない。  
3. **Fold 間の振れ幅が大きい**  
   - データ分割のたびに 5〜10 pt 変動 → 特徴量の信号が弱い証拠。  

---

## 3. 主要なボトルネック

| 症状 | 想定原因 |
|------|----------|
| Accuracy が 0.3–0.4 に張り付く | 既存 4 指標に情報量が乏しい |
| クラス1 の判別失敗 | 「横ばい」定義が粗い (±1 %) |
| Fold ごとに成績が不安定 | クラス不均衡 + ハイパラ未調整 |

---

## 4. 改善ポイント（優先度順）

1. **ターゲット再設計**  
   - 閾値を銘柄別 ATR/σ に連動させる。  
   - または 2 クラスモデル (Long/Short) を別々に学習し後段で統合する。  

2. **特徴量拡張**  
   - SMA/EMA クロス、MACD、ATR、ADX、出来高指標、VWAP 乖離率。  
   - 外部要因 (TOPIX, USD/JPY など) をラグ付きで投入。  

3. **ハイパーパラメータ探索**  
   - `learning_rate 0.05–0.2`, `max_depth 3–6`, `subsample 0.6–0.9`,  
     `scale_pos_weight = 1 / class_freq` を Optuna で 50–100 試行。  

4. **検証方法の現実寄り強化**  
   - Walk‑forward 検証で未来情報漏れを排除。  
   - 週次リサンプリング＋週次ラベルでノイズを低減。  

5. **運用指向の評価指標**  
   - Long / Short Precision, 累積リターン, 最大ドローダウン などを追加。  

---

## 5. 次アクション

- [ ] ターゲット閾値を ATR ベースに置き換えて再学習  
- [ ] 主要テクニカル指標 10 種を追加し特徴量セットを拡充  
- [ ] Optuna でハイパラチューニング (100 トライ)  
- [ ] Walk‑forward 検証スクリプトを実装し直す  

---

*Generated by DEMO4 pipeline – 2025‑06‑10*